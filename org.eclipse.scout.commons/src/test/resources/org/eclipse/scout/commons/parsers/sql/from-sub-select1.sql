SELECT    O.OPPORTUNITY_NR,
          P.PERSON_NR,
          O.ICON,
          ORS_UTIL.GET_USER_CODE(O.PRODUCT_UID, 246) || ' (' || P.DISPLAY_NAME || ')'

, ( SELECT ORS_UTIL.GET_USER_CODE ( PROD2.UC_UID , 246 ) || ' - ' || ORS_UTIL.GET_USER_CODE ( PROD1.UC_UID , 246 ) FROM ORS_UC PROD1 , ORS_UC PROD2 WHERE PROD1.CODE_TYPE = 91639 AND PROD2.PARENT_UID = 0 AND PROD1.PARENT_UID > 0 AND PROD1.PARENT_UID = PROD2.UC_UID CONNECT BY NOCYCLE PRIOR PROD1.PARENT_UID = PROD1.UC_UID START WITH PROD1.UC_UID = O.PRODUCT_UID ) , O.PRODUCT_UID , P.DISPLAY_NAME , O.STATUS_UID , O.EVT_VALIDITY_START , O.EVT_VALIDITY_END , O.SALES_AMOUNT , O.CURRENCY_UID , O.ORIGIN_UID , O.NOTES , R.DISPLAY_NAME , C.BUSINESS_CASE , CD.DATA AS CI_TITLE , DECODE ( C.MANDATORY , 0 , 308127 , 1 , 308126 , NULL ) , ( SELECT COUNT ( 1 ) FROM ORS_VISIT_OPPORTUNITY VO , ORS_VISIT V WHERE VO.VISIT_NR = V.VISIT_NR AND VO.OPPORTUNITY_NR = O.OPPORTUNITY_NR AND VO.ACTIVE = 1 AND V.ACTIVE = 1 AND V.STATUS_UID <> 3513 ) , DECODE ( O.NOTIFY , 1 , DECODE ( O.RESPONSIBLE_USER_NR , PO.CONSULTANT_USER_NR , 'bold' , PO.CARER_USER_NR , 'bold' , 'plain' ) , 'plain' ) , P.PERSON_OID , P.PERSON_NO FROM ORS_OPPORTUNITY O , ORS_PERSON P , ORS_PERSON_ADDRESS PA , ORS_USER U , ORS_PERSON R , ORS_CI C , ORS_CI_DATA CD , ORS_PORTFOLIO PO WHERE O.ACTIVE = 1 AND 1 = DECODE ( 100 , 100 , 1 , 0 , 0 , ORS_UTIL.PERSON_PRIV ( 100 , O.PERSON_NR , 695676206 , 75221325 , NEW NUMBERARRAY ( ) , NEW NUMBERARRAY ( ) , NEW NUMBERARRAY ( ) ) ) AND P.PERSON_NR = O.PERSON_NR AND PO.PORTFOLIO_NR = P.PORTFOLIO_NR AND PA.TYPE_UID (+) = 2469 AND PA.PERSON_NR (+) = P.PERSON_NR AND U.USER_NR = O.RESPONSIBLE_USER_NR AND R.PERSON_NR = U.USER_NR AND C.CI_NR (+) = O.CI_NR AND CD.CI_DATA_NR (+) = C.TITLE_CI_DATA_NR AND CD.LANGUAGE_UID (+) = 246 AND P.PORTFOLIO_NR = 739561261 AND ROWNUM <= 5000 AND 1 = 1 AND ( ( O.STATUS_UID IN ( 146114 , 253592 , 308124 ) ) ) AND O.CURRENCY_UID = 112148 AND 1 = 1
